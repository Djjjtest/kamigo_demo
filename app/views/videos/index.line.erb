[
  <% if @keyword.present? %>
    {
      "type":"text",
      "text": "您查詢的關鍵字為<%= @keyword %>，以下是符合條件的影片列表：" 
    },
  <% end %>
  {
    "type": "flex",
    "altText": "This is a Flex Message",
    "contents": {
      "type": "carousel",
      "contents": [
        <% @videos.each do |video| %>
        {
          "type": "bubble",
          "size": "micro",
          "hero": {
            "type": "image",
            "url": "<%= video[:縮圖網址] %>",
            "size": "full",
            "aspectMode": "cover",
            "aspectRatio": "480:360"
          },
          "body": {
            "type": "box",
            "layout": "vertical",
            "contents": [
              {
                "type": "box",
                "layout": "vertical",
                "contents": [
                  {
                    "type": "text",
                    "text": "<%= video[:標題] %>",
                    "weight": "bold",
                    "size": "sm",
                    "wrap": true
                  }
                ],
                "height": "80px"
              },
              {
                "type": "button",
                "action": {
                  "type": "uri",
                  "label": "去看看",
                  "uri": "<%= video[:影片網址] %>"
                },
                "style": "primary",
                "height": "sm",
                "margin": "10px"
              }
            ],
            "spacing": "sm",
            "paddingAll": "13px"
          }
        }<%= "," if video != @videos.last %>
        <% end %>
      ]
    }
  },

  <%= raw(Kamiflex.json(self) do
    alt_text "LINE Flex Message Showcase: Local Search"
    carousel do
      bubbles @videos, size: :micro do |video|
        hero video[:縮圖網址], size: :full, aspectMode: "cover", aspectRatio: "480:360"
        body spacing: :sm, paddingAll: "13px" do
          vertical_box height: "80px" do
            text video[:標題], weight: :bold, size: :sm, wrap: true
          end
          url_button "去看看", video[:影片網址], style: "primary", height: "sm", margin: "10px" 
        end
      end
    end
  end) %>

]